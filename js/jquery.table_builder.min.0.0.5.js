////////////////////////////////////////////////////||
// ROB KANDEL  										||
// kandelrob@gmail.com								||
// 													||
// created 04.02.15	| updated 05.24.15				||
// jquery.table_builder.min.js						||
// version 0.0.5									||
////////////////////////////////////////////////////||

;(function(d,c,a,e){function b(g,f){this._element=d(g);this._settings=d.extend({},b._defaults,f);this._defaults=d.extend(true,{},b._defaults);this.setup()}b._name="table_builder_widget";b._version="0.0.5";b._defaults={random_id:null,src:null,external_data:false,responsive_table:true,table_class:null,table_title:null,table_copyblock:null,table_credit:null,table_source:null,table_source_link:null,fixed_header:true,repeat_header:false,show_search:true,search_input_text:"Search table",search_button_text:"Search",show_row_options:true,visible_row_options:[10,25,50,100,1000000],visible_rows:25,sortable:true,sort_column:null,sort_order:"desc",sort_types:[],column_width:[],ranking:false,bold_sort:true,format_number:true,format_column:[],blank_data:"-",decimals:2,zero_out:false,date_format:"MMMM DD, YYYY",time_format:"hh:mm A",refresh_data:0,row_classes:{},column_classes:{}};b.prototype.setup=function(){this.trigger("initialize");if(this._settings.src==null&&!this._element.is("table")){alert("Please enter table data");this.trigger("failed",{action:{name:"initialize",error:{message:"table source not provided"}}});return false}this.check_css_sheet()};b.prototype.check_css_sheet=function(){if(!d("link[href='https://raw.githubusercontent.com/robkandel/tablebuilder/gh-pages/css/table_builder.min."+b._version+".css']").length){d('<link href="https://raw.githubusercontent.com/robkandel/tablebuilder/gh-pages/css/table_builder.min.'+b._version+'.css" rel="stylesheet">').appendTo("head")}this.init()};b.prototype.init=function(){var f=this;this.trigger("building_table");var g=a.createElement("div");if(this._element.is("table")){this._element.parent().append(g).addClass("tableBuilderNewParent");this._element.addClass("tableBuilderLegacy");this._element=this._element.parent()}else{this._element.append(g)}d(g).addClass("tableBuilderWrapper").attr("id",f.generate_random_id());if(this._settings.table_class!=null){d(g).addClass(this._settings.table_class)}d(g).addClass(((this._settings.responsive_table)?"tableBuilderWrapperResponsive":"tableBuilderWrapperNotResponsive"));if(this._settings.table_title!=null&&this._settings.table_title!=""){this.table_title(this._settings.table_title)}if(this._settings.table_copyblock!=null&&this._settings.table_copyblock!=""){this.table_copyblock(this._settings.table_copyblock)}if(this._settings.show_search||this._settings.show_row_options){this.search_wrapper()}if(this._settings.sortable){this._settings.sort_default=this._settings.sort_order.toLowerCase();this.build_small_sorter()}this.build_preloader();if(!this._element.is("table")&&(this._settings.external_data||typeof(this._settings.src)=="string")){this._settings.external_data=true;this.get_google_data(this._settings.src)}else{if(this._element.find(".tableBuilderLegacy")[0]){this.parse_existing_table()}else{this.parse_data(this._settings.src)}}this.clear_all(this._element.find(".tableBuilderWrapper"))};b.prototype.search_wrapper=function(){var g='<div class="tableBuilderSearchBar'+((!this._settings.show_search&&!this._settings.show_row_options)?" tableBuilderSearchBarSortOnly":"")+'"><div class="tableBuilderSearchBarInner"></div></div>';(this._element.find(".tableBuilderTableWrapper")[0])?((this._element.find("#table_builder_sort_wrapper")[0])?this._element.find("#table_builder_sort_wrapper").before(g):this._element.find("#table_builder_table_wrapper").before(g)):this._element.find(".tableBuilderWrapper").append(g);if(this._settings.show_search){this.build_search({input:this._settings.search_input_text,button:this._settings.search_button_text})}if(this._settings.show_row_options){this.build_row_options()}if(this._settings.sortable){var f=a.createElement("div");this._element.find(".tableBuilderSearchBarInner").append(f);d(f).addClass("clearLeft")}else{this.clear_all(this._element.find(".tableBuilderSearchBarInner"))}};b.prototype.build_search=function(f){if(!this._element.find(".tableBuilderSearchBar")[0]){this.search_wrapper()}if(!this._element.find(".tableBuilderSearchInput")[0]){var g='<div class="tableBuilderSearchInput"><span class="tableBuilderSearchInputWrapper"><input type="text" class="tableBuilderInputField transitionAll" id="table_builder_search_input_field" value="'+(("input" in f)?f.input:this._settings.search_input_text)+'"/><span class="buttonItem transitionAll tableBuilderCloseBtn" id="close_search"><span class="ui-icon transitionAll"></span></span></span><span class="tableBuilderSearchInputText buttonItem transitionAll tableBuilderButton" id="table_builder_search_input_text">'+(("button" in f)?f.button:this._settings.search_button_text)+"</span></div>";(this._element.find(".tableBuilderSearchView")[0])?this._element.find(".tableBuilderSearchView").before(g):this._element.find(".tableBuilderSearchBarInner").append(g);this.create_search_action()}else{this._element.find("#table_builder_search_input_field").val((("input" in f)?f.input:this._settings.search_input_text));this._element.find("#table_builder_search_input_text").html((("button" in f)?f.button:this._settings.search_button_text));this.update({search_input_text:(("input" in f)?f.input:this._settings.search_input_text),search_button_text:(("button" in f)?f.button:this._settings.search_button_text)})}};b.prototype.build_row_options=function(){if(!this._element.find(".tableBuilderSearchBar")[0]){this.search_wrapper()}if(!this._element.find(".tableBuilderSearchView")[0]){var f='<div class="tableBuilderSearchView"><div class="buttonItem transitionAll tableBuilderDropDown tableBuilderSearchRowButton" id="toggle_visible_rows"><div class="tableBuilderSearchRowButtonText">Visible Rows</div><div class="tableBuilderCarrotDown"></div></div></div>';(this._element.find(".tableBuilderSearchInput")[0])?this._element.find(".tableBuilderSearchInput").after(f):this._element.find(".tableBuilderSearchBarInner").append(f);this.clear_all(this._element.find("#toggle_visible_rows"));this.build_row_options_dropdown(this._settings.visible_row_options);this._element.find("#toggle_visible_rows").on("click",function(){((d(this).find("#toggle_visible_rows_list").hasClass("tableBuilderDropDownListActive"))?d(this).find("#toggle_visible_rows_list").removeClass("tableBuilderDropDownListActive"):d(this).find("#toggle_visible_rows_list").addClass("tableBuilderDropDownListActive"))})}};b.prototype.build_row_options_dropdown=function(f){(this._element.find("#toggle_visible_rows_list")[0])?this._element.find("#toggle_visible_rows_list").empty():this._element.find("#toggle_visible_rows").append('<ul class="transitionAll tableBuilderDropDownList tableBuilderSearchRowList" id="toggle_visible_rows_list"></ul>');if(!Array.isArray){Array.isArray=function(i){return Object.prototype.toString.call(i)==="[object Array]"}}var j=((Array.isArray(f))?f:this._settings.visible_row_options);for(var g=0;g<j.length;g++){var h=a.createElement("li");this._element.find("#toggle_visible_rows_list").append(h);d(h).addClass("buttonItem").addClass("transitionAll").addClass("tableBuilderDropDownListItem");(j[g].toString().toLowerCase()=="all"||j[g]==1000000)?d(h).attr("data-value","1000000").html("All Rows"):d(h).attr("data-value",j[g]).html(j[g]+" Rows");if(j[g]==this._settings.visible_rows){d(h).addClass("tableBuilderDropDownListItemActive")}}this.create_show_row_options()};b.prototype.build_small_sorter=function(){if(!this._element.find(".tableBuilderSortWrapper")[0]){if(!this._element.find(".tableBuilderSearchBar")[0]){this.search_wrapper()}this._element.find(".tableBuilderSearchBarInner").append('<div class="tableBuilderSortWrapper'+((!this._settings.show_search&&!this._settings.show_row_options)?" tableBuilderSortWrapperOnly":"")+'"><div class="buttonItem transitionAll tableBuilderDropDown tableBuilderSortToggleButton" id="toggle_sort_rows"><div class="tableBuilderSearchRowButtonText">Sort By</div><div class="tableBuilderCarrotDown"></div></div></div>');this.clear_all(this._element.find(".tableBuilderSortToggleButton"));this.clear_all(this._element.find(".tableBuilderSearchBarInner"))}};b.prototype.build_preloader=function(){if(!this._element.find(".tableBuilderTableWrapper")[0]){this._element.find(".tableBuilderWrapper").append('<div class="tableBuilderTableWrapper"></div>')}this._element.find(".tableBuilderTableWrapper").append('<div class="tableBuilderPreloaderWrapper"><div class="tableBuilderPreloaderSpinnerWrapper"><div class="tableBuilderPreloaderSpinner"></div><div class="tableBuilderPreloaderSpinnerText">Loading Data...</div></div></div>')};b.prototype.build_headers=function(){if(!this._element.find(".tableBuilderHeader")[0]){if(!this._element.find(".tableBuilderTableWrapper")[0]){this._element.find(".tableBuilderWrapper").append('<div class="tableBuilderTableWrapper"></div>')}this._element.find(".tableBuilderTableWrapper").append('<div class="tableBuilderTableHeaderWrapper transitionAll"><table class="tableBuilderTableHeader transitionAll'+((this._settings.responsive_table)?" tableBuilderResponsive":" tableBuilderHeaderNotResponsive")+((this._settings.sortable)?" tableBuilderSortable":"")+((this._settings.fixed_header)?" tableBuilderFixedHeader":"")+'"><thead class="tableBuilderHeaderWrapper"><tr class="tableBuilderHeader transitionAll"></tr></thead></table></div>')}for(var g in this._header_list){this._element.find(".tableBuilderHeader").append('<th class="tableBuilderHeaderText tableBuilderHeaderPos_'+g+((g in this._settings.column_classes)?(" "+this._settings.column_classes[g]):"")+" tableBuilderHeader_"+this._columns.toString()+((typeof(this._settings.column_width[g])!="undefined"&&this._settings.column_width[g]===0)?" tableBuilderHeaderHidden":"")+'" id="table_builder_header_'+g+'"'+((typeof(this._settings.column_width[g])!="undefined"&&this._settings.column_width[g]!=="")?(' style="width:'+this._settings.column_width[g]+'%"'):"")+'><div class="tableBuilderHeaderTextValue'+((this._settings.sortable)?" tableBuilderHeaderSortable":"")+((g==this._settings.sort_column)?((this._settings.sort_order.toLowerCase()=="desc")?" tableBuilderHeaderSortableDesc tableBuilderHeaderSortableActive":" tableBuilderHeaderSortableAsc tableBuilderHeaderSortableActive"):"")+'">'+this._header_list[g].replace(/--/g," ")+"</div></th>");if(this._settings.sortable){if(!this._element.find("#toggle_visible_sort_list")[0]){var f=a.createElement("ul");this._element.find("#toggle_sort_rows").append('<ul class="transitionAll tableBuilderDropDownList tableBuilderSearchSortList" id="toggle_visible_sort_list"></ul>')}if(!this._element.find('li[data-value="table_builder_header_'+g+'"]')[0]){this._element.find("#toggle_visible_sort_list").append('<li class="buttonItem transitionAll tableBuilderDropDownListItem'+((g==this._settings.sort_column)?" tableBuilderDropDownListItemActive":"")+'" data-value="table_builder_header_'+g+'">'+this._header_list[g].replace(/--/g," ")+"</li>")}}}this.clear_all(this._element.find(".tableBuilderHeader"));if(this._settings.fixed_header){this.create_fixed_header()}if(this._settings.sortable){this._settings.sort_original=this._settings.sort_order;this._element.find("#toggle_sort_rows").on("click",function(){((d(this).find("#toggle_visible_sort_list").hasClass("tableBuilderDropDownListActive"))?d(this).find("#toggle_visible_sort_list").removeClass("tableBuilderDropDownListActive"):d(this).find("#toggle_visible_sort_list").addClass("tableBuilderDropDownListActive"))});this.create_header_buttons_small_select();this.create_header_buttons()}this.build_body()};b.prototype.build_body=function(){if(!this._element.find(".tableBuilderTableBody")[0]){if(!this._element.find(".tableBuilderTableWrapper")[0]){this._element.find(".tableBuilderWrapper").append('<div class="tableBuilderTableWrapper"></div>')}this._element.find(".tableBuilderTableWrapper").append('<div class="tableBuilderTableBodyWrapper transitionAll"><table class="tableBuilderTableBody transitionAll'+((this._settings.responsive_table)?" tableBuilderResponsive":" tableBuilderHeaderBodyNotResponsive")+((this._settings.sortable)?" tableBuilderSortable":"")+'"><tbody class="tableBuilderBodyWrapper transitionAll"></tbody></table></div>')}if(this._settings.table_credit!=null){this.credit_text(this._settings.table_credit)}if(this._settings.table_source!=null){this.source_text({text:this._settings.table_source,link:this._settings.table_source_link})}this._settings.pagination=1;(this._settings.sort_column!=null&&!isNaN(this._settings.sort_column)&&this._settings.sort_column<this._columns)?this.sort(this._settings.sort_column,this._settings.sort_order,""):this.add_table_rows(this._data,this._settings.pagination,this._settings.visible_rows)};b.prototype.build_pagination=function(h,i){(!this._element.find(".tableBuilderMoreButtonsWrapper")[0])?this._element.find(".tableBuilderTableWrapper").after('<div class="tableBuilderMoreButtonsWrapper"><div class="tableBuilderMoreButtonsInnerWrapper"></div></div>'):this._element.find(".tableBuilderMoreButtonsInnerWrapper").empty();this._element.find(".tableBuilderMoreButtonsInnerWrapper").append('<div class="tableBuilderNextBTN tableBuilderMoreButton buttonItem transitionAll" id="table_builder_next_btn">Next</div>');this._element.find("#table_builder_next_btn").unbind("click");this._element.find("#table_builder_next_btn").on("click",d.proxy(this.next,b._this,this));var g=Math.ceil(h/i);this._element.find(".tableBuilderMoreButtonsInnerWrapper").append('<div class="tableBuilderNumberButtonWrapper'+((g<=10)?"":" tableBuilderNumberButtonWrapperLarge")+'"><div class="tableBuilderNumberButtonInner"></div></div><div class="tableBuilderNumberInputWrapper" id="table_builder_number_input_wrapper"><input type="text" class="tableBuilderInputField tableBuilderNumberInputField transitionAll'+((g<=10)?" tableBuilderNumberInputFieldSmall":"")+'" id="table_builder_number_input_field" value="1/'+g.toString()+'" /></div>');this._element.find("#table_builder_number_input_field").unbind();var f=this;this._element.find("#table_builder_number_input_field").on("blur",d.proxy(function(){f.paginate(f._element.find("#table_builder_number_input_field").val().split("/")[0],f)})).on("keyup",d.proxy(function(j){if(j.keyCode==13){f.paginate(f._element.find("#table_builder_number_input_field").val().split("/")[0],f)}}));this._element.find(".tableBuilderMoreButtonsInnerWrapper").append('<div class="tableBuilderPrevBTN tableBuilderMoreButton tableBuilderNotActiveBTN buttonItem transitionAll" id="table_builder_prev_btn">Prev</div>');this._element.find("#table_builder_prev_btn").unbind("click");this._element.find("#table_builder_prev_btn").on("click",d.proxy(this.prev,b._this,this));this.build_pagination_number_buttons(g);this._settings.pagination=1;this.clear_all(this._element.find(".tableBuilderMoreButtonsInnerWrapper"))};b.prototype.build_pagination_number_buttons=function(h){for(var g=0;g<h;g++){this._element.find(".tableBuilderNumberButtonInner").append('<div class="tableBuilderNumber transitionAll'+((g==0)?" tableBuilderNumberActive":"")+'" id="table_builder_number_'+g+'">'+parseFloat(g+1)+"</div>")}this.clear_all(this._element.find(".tableBuilderNumberButtonInner"));var f=this;this._element.find(".tableBuilderNumberButtonInner").find(".tableBuilderNumber").each(function(){d(this).on("click",d.proxy(f.paginate,b._this,(parseFloat(d(this).attr("id").split("table_builder_number_")[1])+1),f))})};b.prototype.repeat_header=function(){this._element.find(".tableBuilderBodyWrapper").append('<tr class="tableSortRow tableRowRepeatedHeader"></tr>');for(var f in this._header_list){this._element.find(".tableRowRepeatedHeader").last().append('<th class="tableBuilderHeaderText tableBuilderHeaderPos_'+f+((f in this._settings.column_classes)?(" "+this._settings.column_classes[f]):"")+" tableBuilderHeader_"+this._columns.toString()+((typeof(this._settings.column_width[f])!="undefined"&&this._settings.column_width[f]===0)?" tableBuilderHeaderHidden":"")+'" id="table_builder_header_'+f+'"'+((typeof(this._settings.column_width[f])!="undefined"&&this._settings.column_width[f]!=="")?(' style="width:'+this._settings.column_width[f]+'%"'):"")+'><div class="tableBuilderHeaderTextValue'+((this._settings.sortable)?" tableBuilderHeaderSortable":"")+((f==this._settings.sort_column)?((this._settings.sort_order.toLowerCase()=="desc")?" tableBuilderHeaderSortableDesc tableBuilderHeaderSortableActive":" tableBuilderHeaderSortableAsc tableBuilderHeaderSortableActive"):"")+'">'+this._header_list[f].replace(/--/g," ")+"</div></th>")}this.clear_all(this._element.find(".tableRowRepeatedHeader").last());if(this._settings.sortable){this.create_header_buttons()}};b.prototype.no_rows_found=function(){this._element.find(".tableBuilderBodyWrapper").append('<div class="tableSortNoRows">No Results Found</div>');var f=this;this._element.find(".tableSortNoRows").on("click",function(){d(this).remove();f.clear_search();f._element.find("#close_search").hide();f._element.find("#table_builder_search_input_field").val(f._settings.search_input_text)})};b.prototype.clear_all=function(g){var f=a.createElement("div");g.append(f);d(f).addClass("clearAll")};b.prototype.check_time=function(i){var g=false;var f=/^\d{1,2}[:]\d{2}([:]\d{2})?( [aApP][mM]?)?$/;if(!f.test(i)){return false}if(i.toLowerCase().indexOf("p")!=-1){g=true}if(i.toLowerCase().indexOf("a")!=-1){g=true}var h=i.split(":");if((parseFloat(h[0])<0)||(parseFloat(h[0])>23)){return false}if(g){if((parseFloat(h[0])<1)||(parseFloat(h[0])>12)){return false}}if((parseFloat(h[1])<0)||(parseFloat(h[1])>59)){return false}if(h.length>2){if((parseFloat(h[2])<0)||(parseFloat(h[2])>59)){return false}}return true};b.prototype.has_html=function(f){return f.toString().match(/<.*?>/ig)!=null?true:false};b.prototype.find_data=function(h,f){for(var g=0;g<this._data.length;g++){if(h[g].data[f]!==""&&h[g].data[f]!==this._settings.blank_data){return h[g].data[f]}}return h[0].data[f]};b.prototype.generate_random_id=function(h){var j="",f="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var g=0;g<20;g++){j+=f[Math.round(Math.random()*(f.length-1))]}this._settings.random_id=j;return j};b.prototype.parse_data=function(j){this._data=[];this._original_data=[];this._header_list=[];this._header_list=j.data[0];this._columns=0;this._columns=j.data[0].length;this._rows=0;this._rows=j.data.length-1;if(this._settings.ranking&&this._header_list[0]!="#"){this._header_list.splice(0,0,"#");this._columns++;this._settings.ranking_set=false}for(var f=1;f<j.data.length;f++){var h={ranking:f,data:[],_class:""};if(this._settings.ranking){h.data.push(f)}if((f-1) in this._settings.row_classes){h._class=(" "+this._settings.row_classes[f-1])}for(var g in j.data[f]){h.data.push(this.strip_microsoft_format(j.data[f][g]))}this._data.push(h);this._original_data.push(h)}if(this._element.find(".tableBuilderSearchView")[0]&&this._rows<this._settings.visible_row_options[0]){this._element.find(".tableBuilderSearchView").addClass("tableBuilderSearchViewHidden");if(!this._settings.show_search){this._element.find(".tableBuilderSearchBar").addClass("tableBuilderSearchInputHidden");if(!this._settings.sortable){this._element.find(".tableBuilderSearchBar").addClass("tableBuilderSearchAllHidden")}}}this.trigger("parse_data_complete");this.build_headers()};b.prototype.parse_existing_table=function(){this._data=[];this._original_data=[];this._header_list=[];this._columns=0;this._rows=0;var f=[],h=[];var i=0;this._element.find(".tableBuilderLegacy").find("tr").each(function(){var g={};var j=0;d(this).children().each(function(){if(i==0){h.push(d(this).html())}g[h[j]]=d(this).html();j++});(i==0)?f.push(h):f.push(g);i++});this.parse_data({data:f})};b.prototype.get_google_data=function(g){this._data=[];this._original_data=[];this._header_list=[];this._columns=0;this._rows=0;var f=this;d.ajax({url:this.format_spreadsheet_url(g),dataType:"jsonp",success:function(h){f.breakdown_google_data(h);if(f._settings.refresh_data>0){f._refresh_data=setTimeout(function(){clearTimeout(f._refresh_data);f.refresh_data(f._settings.refresh_data)},f._settings.refresh_data*60000)}},error:function(j,h,i){f._element.find(".tableBuilderPreloaderSpinner").hide();f._element.find(".tableBuilderPreloaderSpinnerText").html("Error<br/><br/> Can't Find Data")}})};b.prototype.format_spreadsheet_url=function(f){return(f.indexOf("https://spreadsheets.google.com/feeds/list/")!=-1)?f:((f.indexOf("https://docs.google.com/")!=-1)?("https://spreadsheets.google.com/feeds/list/"+((f.indexOf("pub?key=")!=-1)?f.split("pub?key=")[1].split("&output=")[0]:f.split("https://docs.google.com/spreadsheets/d/")[1].split("/pubhtml")[0])+"/1/public/values?alt=json-in-script"):f)};b.prototype.breakdown_google_data=function(k){var j=[],n=[];for(var h in k.feed.entry){var l={};for(var o in k.feed.entry[h]){if(o.indexOf("gsx$")!=-1){var f=o.toString().split("gsx$");if(h==0){n.push(f[1])}l[f[1]]=k.feed.entry[h][o].$t}}if(h==0){j.push(n)}j.push(l)}this.parse_data({data:j})};b.prototype.create_header_buttons=function(){var f=this;this._element.find(".tableBuilderWrapper").find(".tableBuilderHeaderText").each(function(){d(this).unbind("click");d(this).on("click",d.proxy(function(){f.header_click(d(this).attr("id").split("table_builder_header_")[1])}))})};b.prototype.toggle_header_arrows=function(g,f){this._element.find("#toggle_visible_sort_list").find(".tableBuilderDropDownListItemActive").removeClass("tableBuilderDropDownListItemActive");this._element.find("#toggle_visible_sort_list").find('li[data-value="table_builder_header_'+g+'"]').addClass("tableBuilderDropDownListItemActive");if(g!=f){this._element.find(".tableBuilderHeaderSortableActive").removeClass("tableBuilderHeaderSortableActive").removeClass("tableBuilderHeaderSortableAsc").removeClass("tableBuilderHeaderSortableDesc");this._element.find("#table_builder_header_"+g).find(".tableBuilderHeaderTextValue").addClass("tableBuilderHeaderSortableActive");(this._settings.sort_order.toLowerCase()=="desc")?this._element.find("#table_builder_header_"+g).find(".tableBuilderHeaderTextValue").addClass("tableBuilderHeaderSortableDesc"):this._element.find("#table_builder_header_"+g).find(".tableBuilderHeaderTextValue").addClass("tableBuilderHeaderSortableAsc")}else{((this._settings.sort_order.toLowerCase()=="desc")?this._element.find("#table_builder_header_"+g).find(".tableBuilderHeaderTextValue").removeClass("tableBuilderHeaderSortableAsc").addClass("tableBuilderHeaderSortableDesc"):this._element.find("#table_builder_header_"+g).find(".tableBuilderHeaderTextValue").removeClass("tableBuilderHeaderSortableDesc").addClass("tableBuilderHeaderSortableAsc"))}};b.prototype.create_show_row_options=function(){var f=this;this._element.find("#toggle_visible_rows_list").find(".tableBuilderDropDownListItem").each(function(){d(this).unbind("click");d(this).on("click",function(){f._settings.visible_rows=parseFloat(d(this).attr("data-value"));f._element.find("#toggle_visible_rows_list .tableBuilderDropDownListItemActive").removeClass("tableBuilderDropDownListItemActive");d(this).addClass("tableBuilderDropDownListItemActive");f.visible_rows(parseFloat(d(this).attr("data-value")))})})};b.prototype.create_header_buttons_small_select=function(){var f=this;this._element.find("#toggle_visible_sort_list").find(".tableBuilderDropDownListItem").each(function(){d(this).unbind("click");d(this).on("click",d.proxy(function(){f.header_click(d(this).attr("data-value").split("table_builder_header_")[1])}))})};b.prototype.in_format_array=function(f,h){for(var i=0;i<f.length;i++){if(parseFloat(f[i])==parseFloat(h)){return true}}return false};b.prototype.create_search_action=function(){var f=this;this._element.find("#table_builder_search_input_field").on("focus",function(){if(d(this).val()==f._settings.search_input_text){d(this).val("")}}).on("blur",function(){if(d(this).val()==""){d(this).val(f._settings.search_input_text)}}).on("keyup",d.proxy(function(g){if(g.keyCode==13){if(d(this).val()!=f._settings.search_input_text&&d(this).val()!=""){f.search(d(this).val());f._element.find("#close_search").show()}}}));this._element.find("#table_builder_search_input_text").on("click",function(){if(f._element.find("#table_builder_search_input_field").val()!=""&&f._element.find("#table_builder_search_input_field").val()!=f._settings.search_input_text){f.search(f._element.find("#table_builder_search_input_field").val());f._element.find("#close_search").show()}});this._element.find("#close_search").unbind("click");this._element.find("#close_search").on("click",function(){f._element.find("#close_search").hide();f._element.find("#table_builder_search_input_field").val(f._settings.search_input_text);f.clear_search()})};b.prototype.create_fixed_header=function(){var f=this;d(c).on("resize.tb_resize scroll.tb_scroll",function(i){if(f._settings.fixed_header&&f._element.find(".tableBuilderTableHeader").is(":visible")){var g=f._element.find(".tableBuilderTableBody").offset().top;var h=d(c).scrollTop();if(h>g-40){f._element.find(".tableBuilderTableHeaderWrapper").css({height:f._element.find(".tableBuilderHeaderWrapper").height()});f._element.find(".tableBuilderHeaderWrapper").addClass("tableBuilderHeaderWrapperFixed").css({width:f._element.find(".tableBuilderWrapper").width(),height:"auto"})}else{if(h<=g){f._element.find(".tableBuilderHeaderWrapper").removeClass("tableBuilderHeaderWrapperFixed");f._element.find(".tableBuilderHeaderWrapper").css({width:"100%"});f._element.find(".tableBuilderTableHeaderWrapper").css({height:"auto"})}}if(h>f._element.find(".tableBuilderTableWrapper").height()+f._element.find(".tableBuilderTableWrapper").offset().top-f._element.find(".tableBuilderHeaderWrapper").height()){f._element.find(".tableBuilderHeaderWrapper").removeClass("tableBuilderHeaderWrapperFixed");f._element.find(".tableBuilderHeaderWrapper").css({width:"100%"});f._element.find(".tableBuilderTableHeaderWrapper").css({height:"auto"})}}})};b.prototype.strip_microsoft_format=function(f){return((typeof(f)=="string")?f.replace(/[\u2018|\u2019|\u201A]/g,"'").replace(/[\u201C|\u201D|\u201E]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/[\u2026]/g,"...").replace(/\u02C6/g,"^").replace(/\u2039/g,"<").replace(/\u203A/g,">").replace(/[\u02DC|\u00A0]/g," "):f)};b.prototype.format_time_value=function(g){var f=g.split(":");if(f.length==2){f[2]=0}if(g.toLowerCase().indexOf("pm")!=-1){if(parseFloat(f[0])<12){f[0]=12+parseFloat(f[0])}}var h=new Date();return new Date(h.getFullYear(),h.getMonth(),h.getDay(),parseFloat(f[0]),parseFloat(f[1]),parseFloat(f[2]))};b.prototype.leading_zero=function(f){return((parseFloat(f)<10)?("0"+f.toString()):f)};b.prototype.time_hours=function(f){if(parseFloat(f)>12){return parseFloat(f)-12}return f};b.prototype.am_pm=function(f,g){return((parseFloat(f)>=12)?((g=="A")?"PM":"pm"):((g=="A")?"AM":"am"))};b.prototype.number_ender=function(g){var f=parseFloat(g)%10;if(f==1&&parseFloat(g)!=11){return g.toString()+"st"}if(f==2&&parseFloat(g)!=12){return g.toString()+"nd"}if(f==3&&parseFloat(g)!=13){return g.toString()+"rd"}return g.toString()+"th"};b.prototype.format_pretty_numbers=function(i,f,k){var h=this.format_number_symbol(i),l=(i.toString().replace(/[$%+,]/g,"")*1),g=((typeof(f)!="undefined")?f:this._settings.decimals),j=((typeof(k)!="undefined")?k:this._settings.zero_out);return h.dollar+h.positive+this.add_commas((((g==0)?parseInt(Math.round(l)):((j)?((Math.round((parseFloat(l)*Math.pow(10,(g))))/Math.pow(10,(g))).toFixed(g)):(Math.round((parseFloat(l)*Math.pow(10,(g))))/Math.pow(10,(g)))))))+h.percent};b.prototype.format_number_symbol=function(i){var f=false,j="",h="",g="";if(i.toString().match(/.*[$%+,].*/ig)!=null){if(i.indexOf("$")!=-1){j="$"}else{if(i.indexOf("+")!=-1){g="+"}else{if(i.indexOf("%")!=-1){h="%"}}}i=parseFloat(i.toString().replace(/[$%+,]/g,""));f=true}return{bool:f,dollar:j,percent:h,positive:g}};b.prototype.format_special_numbers=function(f){var g=f.replace(/[^a-zA-Z0-9]/g,".").split(".");if(g.length==1){return $TS.prototype.tb_format_numbers(parseFloat(f))}else{return f}};b.prototype.add_commas=function(j){j+="";var f=j.split(".");var i=f[0];var g=f.length>1?"."+f[1]:"";var h=/(\d+)(\d{3})/;while(h.test(i)){i=i.replace(h,"$1,$2")}return i+g};b.prototype.sort_by_string=function(f){return function(h,g){var j=((h.data[parseFloat(f._settings.sort_column)]!==""&&h.data[parseFloat(f._settings.sort_column)]!==f._settings.blank_data)?(""+h.data[parseFloat(f._settings.sort_column)].replace(/[^a-zA-Z-]/g,"").toLowerCase()):f.move_blank_data("string")).toLowerCase();var i=((g.data[parseFloat(f._settings.sort_column)]!==""&&g.data[parseFloat(f._settings.sort_column)]!==f._settings.blank_data)?(""+g.data[parseFloat(f._settings.sort_column)].replace(/[^a-zA-Z-]/g,"").toLowerCase()):f.move_blank_data("string")).toLowerCase();return((f._settings.sort_order.toLowerCase()=="desc")?(j>i?-1:j<i?1:0):(j<i?-1:j>i?1:0))}};b.prototype.sort_by_number=function(f){return function(h,g){var j=(h.data[parseFloat(f._settings.sort_column)]!==""&&h.data[parseFloat(f._settings.sort_column)]!==f._settings.blank_data)?((isNaN(h.data[parseFloat(f._settings.sort_column)].toString().replace(/[$£€%+,]/g,"")*1))?(parseFloat(f.sort_special_numbers(h.data[parseFloat(f._settings.sort_column)]).toString().replace(/[$£€,%+]/g,""))):(parseFloat(h.data[parseFloat(f._settings.sort_column)].toString().replace(/[$£€,%+]/g,"")))):f.move_blank_data("number");var i=(g.data[parseFloat(f._settings.sort_column)]!==""&&g.data[parseFloat(f._settings.sort_column)]!==f._settings.blank_data)?((isNaN(g.data[parseFloat(f._settings.sort_column)].toString().replace(/[$£€%+,]/g,"")*1))?(parseFloat(f.sort_special_numbers(g.data[parseFloat(f._settings.sort_column)]).toString().replace(/[$£€,%+]/g,""))):(parseFloat(g.data[parseFloat(f._settings.sort_column)].toString().replace(/[$£€,%+]/g,"")))):f.move_blank_data("number");return((f._settings.sort_order.toLowerCase()=="desc")?(j>i?-1:j<i?1:0):(j<i?-1:j>i?1:0))}};b.prototype.sort_special_numbers=function(f){var h=f.replace(/[^a-zA-Z0-9]/g,".").split(".");if(h.length==1){return h[0]}else{for(var g=1;g<h.length;g++){if(parseFloat(h[g])<10){h[g]="0"+parseFloat(h[g]).toString()}}return h.join().replace(/,/g,".")}};b.prototype.sort_by_date=function(f){return function(h,g){var j=(h.data[parseFloat(f._settings.sort_column)]!==""&&h.data[parseFloat(f._settings.sort_column)]!==f._settings.blank_data)?(Date.parse(h.data[parseFloat(f._settings.sort_column)])):f.move_blank_data("date");var i=(g.data[parseFloat(f._settings.sort_column)]!==""&&g.data[parseFloat(f._settings.sort_column)]!==f._settings.blank_data)?(Date.parse(g.data[parseFloat(f._settings.sort_column)])):f.move_blank_data("date");return((f._settings.sort_order.toLowerCase()=="desc")?(j>i?-1:j<i?1:0):(j<i?-1:j>i?1:0))}};b.prototype.sort_by_time=function(f){return function(h,g){var j=(h.data[parseFloat(f._settings.sort_column)]!==""&&h.data[parseFloat(f._settings.sort_column)]!==f._settings.blank_data)?(f.format_time_value(h.data[parseFloat(f._settings.sort_column)])):f.move_blank_data("time");var i=(g.data[parseFloat(f._settings.sort_column)]!==""&&g.data[parseFloat(f._settings.sort_column)]!==f._settings.blank_data)?(f.format_time_value(g.data[parseFloat(f._settings.sort_column)])):f.move_blank_data("time");return((f._settings.sort_order.toLowerCase()=="desc")?(j>i?-1:j<i?1:0):(j<i?-1:j>i?1:0))}};b.prototype.sort_by_html=function(f){return function(h,g){var j=((h.data[parseFloat(f._settings.sort_column)]!==""&&h.data[parseFloat(f._settings.sort_column)]!==f._settings.blank_data)?(f.strip_html(h.data[parseFloat(f._settings.sort_column)]).toLowerCase()):f.move_blank_data("html")).toLowerCase();var i=((g.data[parseFloat(f._settings.sort_column)]!==""&&g.data[parseFloat(f._settings.sort_column)]!==f._settings.blank_data)?(f.strip_html(g.data[parseFloat(f._settings.sort_column)]).toLowerCase()):f.move_blank_data("html")).toLowerCase();return((f._settings.sort_order.toLowerCase()=="desc")?(j>i?-1:j<i?1:0):(j<i?-1:j>i?1:0))}};b.prototype.strip_html=function(f){return f.replace(/<.*?>/g,"").toLowerCase()};b.prototype.move_blank_data=function(f){if(f=="string"||f=="html"){return(((this._settings.sort_order.toLowerCase()=="asc"&&$TS._tb_settings.sort_default=="desc")||(this._settings.sort_order.toLowerCase()=="asc"&&$TS._tb_settings.sort_default=="asc"))?"zzzzzzzzzz":"aaaaaaaaaa")}else{if(f=="number"){return(this._settings.sort_order.toLowerCase()=="asc")?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY}else{if(f=="date"){return(((this._settings.sort_order.toLowerCase()=="asc"&&$TS._tb_settings.sort_default=="desc")||(this._settings.sort_order.toLowerCase()=="asc"&&$TS._tb_settings.sort_default=="asc"))?Date.parse("3001-12-12"):Date.parse("1001-01-01"))}else{if(f=="time"){return(((this._settings.sort_order.toLowerCase()=="asc"&&$TS._tb_settings.sort_default=="desc")||(this._settings.sort_order.toLowerCase()=="asc"&&$TS._tb_settings.sort_default=="asc"))?this.format_time_value("23:59:59"):this.format_time_value("00:00:00"))}else{return(((this._settings.sort_order.toLowerCase()=="asc"&&$TS._tb_settings.sort_default=="desc")||(this._settings.sort_order.toLowerCase()=="asc"&&$TS._tb_settings.sort_default=="asc"))?"zzzzzzzzzz":"aaaaaaaaaa")}}}}};b.prototype.set_ranking=function(g){for(var f=0;f<g.length;f++){g[f].data[0]=(f+1)}return g};b.prototype.table_title=function(f){if(typeof(f)=="undefined"&&this._element.find(".tableBuilderTitleWrapper")[0]){this._element.find(".tableBuilderTitleWrapper").remove()}else{if(!this._element.find(".tableBuilderTitleWrapper")[0]){this._element.find(".tableBuilderWrapper").prepend('<div class="tableBuilderTitleWrapper"><div class="tableBuilderTitleText">'+f+"</div></div>")}else{this._element.find(".tableBuilderTitleText").html(f);this.update({table_title:f})}}};b.prototype.table_copyblock=function(g){if(typeof(g)=="undefined"&&this._element.find(".tableBuilderSubheadWrapper")[0]){this._element.find(".tableBuilderSubheadWrapper").remove()}else{if(!this._element.find(".tableBuilderSubheadWrapper")[0]){var f='<div class="tableBuilderSubheadWrapper"><div class="tableBuilderSubheadText">'+g+"</div></div>";(this._element.find(".tableBuilderTitleWrapper")[0])?this._element.find(".tableBuilderTitleWrapper").after(f):this._element.find(".tableBuilderWrapper").prepend(f)}else{this._element.find(".tableBuilderSubheadText").html(g);this.update({table_copyblock:g})}}};b.prototype.credit_text=function(f){if(typeof(f)=="undefined"&&this._element.find(".tableBuilderCreditText")[0]){this._element.find(".tableBuilderCreditText").remove()}else{if(!this._element.find(".tableBuilderSourceWrapper")[0]){this._element.find(".tableBuilderTableWrapper").after('<div class="tableBuilderSourceWrapper"></div>')}if(!this._element.find(".tableBuilderCreditText")[0]){this._element.find(".tableBuilderSourceWrapper").append('<div class="tableBuilderCreditText"><span class="tableBuilderCreditLabel">Produced By:</span> '+f+"</div>")}else{this._element.find(".tableBuilderCreditText").html('<span class="tableBuilderCreditLabel">Produced By:</span> '+f);this.update({table_credit:f})}}};b.prototype.source_text=function(f){if(typeof(f)=="undefined"&&this._element.find(".tableBuilderSourceText")[0]){this._element.find(".tableBuilderSourceText").remove()}else{if(!this._element.find(".tableBuilderSourceWrapper")[0]){this._element.find(".tableBuilderTableWrapper").after('<div class="tableBuilderSourceWrapper"></div>')}if(!this._element.find(".tableBuilderSourceText")[0]){this._element.find(".tableBuilderSourceWrapper").prepend('<div class="tableBuilderSourceText">'+(("link" in f&&f.link!=null&&f.link!="")?('<span class="tableBuilderSourceLink">Source:</span> <a href="'+f.link+'" target="_blank">'+f.text+"</a>"):'<span class="tableBuilderSourceLink">Source:</span> '+f.text)+"</div>")}else{this._element.find(".tableBuilderSourceText").html((("link" in f&&f.link!=null&&f.link!="")?('<span class="tableBuilderSourceLink">Source:</span> <a href="'+f.link+'" target="_blank">'+f.text+"</a>"):'<span class="tableBuilderSourceLink">Source:</span> '+f.text));this.update({table_source:f.text,table_source_link:f.link})}}};b.prototype.add_table_rows=function(l,h,k){if(typeof(l)=="undefined"){l=this._data}var g=l.length,f=(typeof(k)!="undefined"&&!isNaN(k))?k:this._settings.visible_rows;var m=0;for(var j=(f*(h-1));j<(((f*h)>g)?g:(f*h));j++){if(this._settings.repeat_header){if(m!=0&&m%parseFloat(this._settings.repeat_header)==0){this.repeat_header()}}this.add_row_data(l,j);m++}if(g>f&&!this._element.find(".tableBuilderMoreButtonsInnerWrapper")[0]){this.build_pagination(g,f)}if(typeof(respond)!="undefined"){respond.update()}this.trigger("build_complete");if(this._element.find(".tableBuilderPreloaderWrapper").is(":visible")){this._element.find(".tableBuilderPreloaderWrapper").hide()}this.trigger("add_table_rows",{action:{name:"add_table_rows",value:{data:l,pagination:h,rows:k}}})};b.prototype.add_row_data=function(h,g){this._element.find(".tableBuilderBodyWrapper").append('<tr class="tableSortRow '+((g%2)?"tableSortOdd":"tableSortEven")+(h[g]._class)+'" data-ranking="'+h[g].ranking+'" data-index="'+g+'" id="table_builder_row_'+g+'"></tr>');for(var f=0;f<h[g].data.length;f++){this._element.find("#table_builder_row_"+g).append('<td class="tableRowInfo tableRowInfoData'+((this._settings.bold_sort&&f==this._settings.sort_column)?" tableRowInfoDataActive":"")+((f in this._settings.column_classes)?(" "+this._settings.column_classes[f]):"")+" tableRowInfoPos_"+f+" tableRowInfo_"+this._columns.toString()+((typeof(this._settings.column_width[f])!="undefined"&&this._settings.column_width[f]===0)?" tableRowInfoDataHidden":"")+'" '+((typeof(this._settings.column_width[f])!="undefined"&&this._settings.column_width[f]!=="")?(' style="width:'+this._settings.column_width[f]+'%"'):"")+">"+((this._settings.responsive_table)?('<div class="tableRowInfoColumn" id="table_row_column_'+g+"_"+f+'">'+this._header_list[f].replace(/--/g," ")+"</div>"):"")+'<div class="tableRowInfoValue" id="table_row_value_'+g+"_"+f+'">'+this.format_row_data(h[g].data[f],f)+"</div>"+((this._settings.responsive_table)?'<div class="clearAll"></div>':"")+"</td>")}this.clear_all(this._element.find("#table_builder_row_"+g));this.trigger("row_added",{action:{name:"row_added",value:{data:h,row:g}}})};b.prototype.format_row_data=function(h,g){if(h===null||h===""){return this._settings.blank_data}else{var f=this.check_data_type(h,g);if(f=="time"){return this.format_time(h,this._settings.time_format)}else{if(f=="number"){if(isNaN(h.toString().replace(/[$%+,]/g,"")*1)){return this.format_special_numbers(h,g)}else{return this.format_number(h,g)}}else{if(f=="date"){return this.format_date(h,this._settings.date_format)}else{if(f=="string"){if(h.indexOf("@")!=-1&&(h.indexOf(".com")!=-1||h.indexOf(".net")!=-1||h.indexOf(".org")!=-1||h.indexOf(".edu")!=-1||h.indexOf(".gov")!=-1)){return this.format_email(h)}else{if(h.charAt(0)=="@"){return this.format_twitter(h)}else{if(h.indexOf(".com")!=-1||h.indexOf(".net")!=-1||h.indexOf(".org")!=-1||h.indexOf(".html")!=-1||h.indexOf(".gov")!=-1){return this.format_link(h)}else{return h}}}}else{return h}}}}return h}};b.prototype.format_time=function(h,i){var g=this.format_time_value(h),f=((typeof(i)!="undefined")?i:this._settings.time_format);return f.replace(/hh/g,this.leading_zero(this.time_hours(g.getHours()))).replace(/HH/g,this.leading_zero(g.getHours())).replace(/mm/g,this.leading_zero(g.getMinutes())).replace(/ss/g,this.leading_zero(g.getSeconds())).replace(/A/g,this.am_pm(g.getHours(),"A")).replace(/a/g,this.am_pm(g.getHours(),"a"))};b.prototype.format_special_numbers=function(g,f){return((g.replace(/[^a-zA-Z0-9]/g,".").split(".").length==1)?this.format_number(parseFloat(g),f):g)};b.prototype.format_number=function(g,f){return((this._settings.format_number||(typeof(this._settings.format_column[f])!="undefined"&&this._settings.format_column[f]==="")||this.in_format_array(this._settings.format_column,f))?this.format_pretty_numbers(g,this._settings.decimals,this._settings.zero_out):g)};b.prototype.format_date=function(k,m){var g=new Date(k),f=((typeof(m)!="undefined")?m:this._settings.date_format),i=["January","February","March","April","May","June","July","August","September","October","November","December"],j=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],l=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],h=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return f.replace(/Do/g,this.number_ender(g.getDate())).replace(/DD/g,this.leading_zero(g.getDate())).replace(/D/g,g.getDate()).replace(/MMMM/g,i[g.getMonth()]).replace(/MMM/g,j[g.getMonth()]).replace(/MM/g,this.leading_zero((g.getMonth()+1))).replace(/Mo/g,this.number_ender((g.getMonth()+1))).replace(/MmM/g,(g.getMonth()+1)).replace(/YYYY/g,g.getFullYear()).replace(/YY/g,g.getFullYear().toString().substr(2,2)).replace(/dddd/g,l[g.getDay()]).replace(/ddd/g,h[g.getDay()])};b.prototype.format_email=function(f){return'<a href="mailto:'+f+'" target="_blank">'+f+"</a>"};b.prototype.format_twitter=function(f){return'<a href="http://twitter.com/'+f.substring(1,f.length)+'" target="_blank">'+f+"</a>"};b.prototype.format_link=function(f){return'<a href="'+((f.indexOf("http://")==-1&&f.indexOf("https://")==-1)?("http://"+f):f)+'" target="_blank">'+f+"</a>"};b.prototype.check_data_type=function(h,g){var f;if(this._settings.sort_types.length>0&&this._settings.sort_types[parseFloat(g)]!=null&&d.inArray(this._settings.sort_types[parseFloat(g)].toLowerCase(),["string","number","date","time","html"])>-1){f=this._settings.sort_types[parseFloat(g)].toLowerCase()}else{if(this.check_time(h)){f="time"}else{if(!isNaN(h)){f="number"}else{if(h.toString().replace(/[,%$+–.]/g,"").replace(/\d+/g,"").length==0){f="number"}else{if(new Date(h)!="Invalid Date"&&!isNaN(new Date(h))&&!isNaN(Date.parse(h))){f="date"}else{if(this.has_html(h)){f="html"}else{f="string"}}}}}}this.trigger("data_type",{action:{name:"data_type",value:{type:f}}});return f};b.prototype.sort=function(i,k,h,f){if(typeof(f)=="undefined"){f=this}var l=((typeof(i)!="undefined"&&!isNaN(i)&&i<=this._columns)?i:0),j=((typeof(k)!="undefined")?k:this._settings.sort_order),g=(typeof(h)!="undefined"&&h!=""&&(d.inArray(h.toLowerCase(),["string","number","date","time","html"])>-1))?h:((this._data[0].data[l]!==""&&this._data[0].data[l]!==this._settings.blank_data)?this.check_data_type(this._data[0].data[l],l):this.check_data_type(this.find_data(this._data,l),l));this._settings.sort_column=l;this._settings.sort_order=j;if(this._element.find(".tableBuilderHeaderPos_"+l)[0]&&!this._element.find(".tableBuilderHeaderPos_"+l).find(".tableBuilderHeaderTextValue").hasClass("tableBuilderHeaderSortable"+j.charAt(0).toUpperCase()+j.slice(1))){this.toggle_header_arrows(l,((this._element.find(".tableBuilderHeaderSortableActive")[0])?this._element.find(".tableBuilderHeaderSortableActive").parent().attr("id").split("table_builder_header_")[1]:-1))}this.clear_table_rows(false);if(l==null){return this.add_table_rows(this._data,this._settings.pagination,this._settings.visible_rows)}if(g=="time"){this._data.sort(this.sort_by_time(f))}else{if(g=="number"){this._data.sort(this.sort_by_number(f))}else{if(g=="date"){this._data.sort(this.sort_by_date(f))}else{if(g=="html"){this._data.sort(this.sort_by_html(f))}else{if(g=="string"){this._data.sort(this.sort_by_string(f))}}}}}if(this._settings.ranking&&!this._settings.ranking_set){this.set_ranking(this._data);this._settings.ranking_set=true}this.add_table_rows(this._data,this._settings.pagination,this._settings.visible_rows);this.trigger("sort_complete",{action:{name:"sort_complete",value:{column:i,direction:k}}})};b.prototype.clear_table_rows=function(f){if(this._element.find(".tableBuilderBodyWrapper")[0]){this._element.find(".tableBuilderBodyWrapper").empty()}if(f&&this._element.find(".tableBuilderMoreButtonsWrapper")[0]){this._element.find(".tableBuilderMoreButtonsWrapper").remove()}this.trigger("rows_cleared")};b.prototype.header_click=function(f){if(this._element.find(".tableBuilderHeaderTextValue").hasClass("tableBuilderHeaderSortable")){var g=((typeof(f)!="undefined")?parseFloat(f):this._settings.sort_column);this._settings.sort_column=g;((g==((this._element.find(".tableBuilderHeaderSortableActive")[0])?this._element.find(".tableBuilderHeaderSortableActive").parent().attr("id").split("table_builder_header_")[1]:-1))?(this._settings.sort_order=((this._settings.sort_order.toLowerCase()=="desc")?"asc":"desc")):(this._settings.sort_order=this._settings.sort_default));this.toggle_header_arrows(this._settings.sort_column,((this._element.find(".tableBuilderHeaderSortableActive")[0])?this._element.find(".tableBuilderHeaderSortableActive").parent().attr("id").split("table_builder_header_")[1]:-1));this.sort(this._settings.sort_column,this._settings.sort_order,"",this)}};b.prototype.visible_rows=function(g){if(typeof(g)=="string"&&g.toLowerCase()=="all"){g=1000000}var f=((typeof(g)!="undefined"&&!isNaN(g))?g:this._settings.visible_rows);this._settings.visible_rows=f;this.clear_table_rows(true);if(!this._element.find("#toggle_visible_rows_list").find('li[data-value="'+f+'"]').hasClass("tableBuilderDropDownListItemActive")){this._element.find("#toggle_visible_rows_list").find(".tableBuilderDropDownListItemActive").removeClass("tableBuilderDropDownListItemActive");if(f>=this._rows){f=1000000}this._element.find("#toggle_visible_rows_list").find('li[data-value="'+f+'"]').addClass("tableBuilderDropDownListItemActive")}this.add_table_rows(this._data,this._settings.pagination,this._settings.visible_rows);this.trigger("visible_rows_changed",{action:{name:"visible_rows_changed",value:{rows:f}}})};b.prototype.next=function(f){if(typeof(f)=="undefined"){f=this}if(f._settings.pagination<Math.ceil(f._rows/f._settings.visible_rows)){f._element.find(".tableBuilderNumberActive").removeClass("tableBuilderNumberActive");f._element.find("#table_builder_number_"+f._settings.pagination).addClass("tableBuilderNumberActive");f.clear_table_rows(false);f._element.find("#table_builder_prev_btn").removeClass("tableBuilderNotActiveBTN");if(parseFloat(f._settings.pagination)==Math.ceil(f._rows/f._settings.visible_rows)-1){f._element.find("#table_builder_next_btn").addClass("tableBuilderNotActiveBTN")}f._settings.pagination++;f._element.find("#table_builder_number_input_field").val(f._settings.pagination.toString()+"/"+Math.ceil(f._rows/f._settings.visible_rows));f.add_table_rows(f._data,f._settings.pagination,f._settings.visible_rows);f.trigger("pagination_complete",{action:{name:"pagination_complete",value:{pagination:f._settings.pagination}}})}};b.prototype.prev=function(f){if(typeof(f)=="undefined"){f=this}if(f._settings.pagination>1){f._element.find(".tableBuilderNumberActive").removeClass("tableBuilderNumberActive");f._settings.pagination--;f._element.find("#table_builder_number_"+(f._settings.pagination-1)).addClass("tableBuilderNumberActive");f.clear_table_rows(false);f._element.find("#table_builder_next_btn").removeClass("tableBuilderNotActiveBTN");if(parseFloat(f._settings.pagination)==1){f._element.find("#table_builder_prev_btn").addClass("tableBuilderNotActiveBTN")}f._element.find("#table_builder_number_input_field").val(f._settings.pagination.toString()+"/"+Math.ceil(f._rows/f._settings.visible_rows));f.add_table_rows(f._data,f._settings.pagination,f._settings.visible_rows);f.trigger("pagination_complete",{action:{name:"pagination_complete",value:{pagination:f._settings.pagination}}})}};b.prototype.paginate=function(g,f){if(typeof(f)=="undefined"){f=this}if(typeof(g)!="undefined"&&g!=""&&!isNaN(g)&&(parseFloat(g)>0&&(parseFloat(g)<=Math.ceil(f._rows/f._settings.visible_rows)))){f._element.find(".tableBuilderNumberActive").removeClass("tableBuilderNumberActive");if(f._element.find("#table_builder_number_"+(g-1))[0]){f._element.find("#table_builder_number_"+(g-1)).addClass("tableBuilderNumberActive")}f._settings.pagination=parseFloat(g);(g>1)?f._element.find("#table_builder_prev_btn").removeClass("tableBuilderNotActiveBTN"):f._element.find("#table_builder_prev_btn").addClass("tableBuilderNotActiveBTN");(g==Math.ceil(f._rows/f._settings.visible_rows))?f._element.find("#table_builder_next_btn").addClass("tableBuilderNotActiveBTN"):f._element.find("#table_builder_next_btn").removeClass("tableBuilderNotActiveBTN");f._element.find("#table_builder_number_input_field").val(f._settings.pagination+"/"+(Math.ceil(f._rows/f._settings.visible_rows)));f.clear_table_rows(false);f.add_table_rows(f._data,f._settings.pagination,f._settings.visible_rows)}};b.prototype.search=function(j){if(typeof(j)!="undefined"){var f=[];for(var h=0;h<this._data.length;h++){row_test:for(var k=0;k<this._data[h].data.length;k++){if(this._data[h].data[k].toString().toLowerCase().indexOf(j.toLowerCase())!=-1){f.push(this._data[h]);break row_test}}}this._data=f;this._rows=f.length;this.clear_table_rows(true);(this._data.length>0)?this.add_table_rows(this._data,this._settings.pagination,this._settings.visible_rows):this.no_rows_found();this.trigger("search",{action:{name:"search",value:{term:j}}})}};b.prototype.clear_search=function(){this.clear_table_rows(true);this._data=[];for(var f=0;f<this._original_data.length;f++){this._data.push(this._original_data[f])}this._rows=this._data.length;this.add_table_rows(this._data,this._settings.pagination,this._settings.visible_rows);this.trigger("clear_search")};b.prototype.refresh_data=function(f){if(this._settings.external_data||typeof(this._settings.src)=="string"){if((typeof(f)=="undefined")||((typeof(f)!="undefined")?parseFloat(f):this._settings.refresh_data)<=0){clearTimeout(this._refresh_data)}this._settings.refresh_data=((typeof(f)!="undefined")?parseFloat(f):this._settings.refresh_data);this._element.find(".tableBuilderPreloaderWrapper").show();this._element.find(".tableBuilderTableHeaderWrapper").remove();this._element.find(".tableBuilderTableBodyWrapper").remove();this._element.find(".tableBuilderMoreButtonsWrapper").remove();this.get_google_data(this._settings.src)}else{this._element.find(".tableBuilderPreloaderWrapper").show();this._element.find(".tableBuilderTableHeaderWrapper").remove();this._element.find(".tableBuilderTableBodyWrapper").remove();this._element.find(".tableBuilderMoreButtonsWrapper").remove();this.parse_data(this._settings.src)}this.trigger("data_refresh",{action:{name:"data_refresh",value:{min:((typeof(f)!="undefined")?parseFloat(f):this._settings.refresh_data)}}})};b.prototype.destroy=function(){this.trigger("destroy_table");this._element.find(".tableBuilderWrapper").remove();d(this._element).removeData("dataviz.table_builder");d(a).off("resize.tb_resize");d(a).off("resize.tb_scroll");if(this._element.find(".tableBuilderLegacy")[0]){this._element.find(".tableBuilderLegacy").removeClass("tableBuilderLegacy");this._element.find(".tableBuilderNewParent").removeClass("tableBuilderNewParent")}};b.prototype.update=function(g){for(var f in g){if(f in this._settings){this._settings[f]=g[f]}}this.trigger("updated_settings",{action:{name:"settings",value:{updated:g,all:this._settings}}})};b.prototype.trigger=function(f,k,h,j,l){var g=d.camelCase(d.grep(["on",f,h],function(m){return m}).join("-").toLowerCase()),i=d.Event([f,"dataviz",h||"table_builder"].join(".").toLowerCase(),d.extend({relatedTarget:this},status,k));this.register({name:f});this._element.trigger(i);if(this.settings&&typeof this.settings[g]==="function"){this.settings[g].call(this,i)}return i};b.prototype.register=function(g){if(!d.event.special[g.name]){d.event.special[g.name]={}}if(!d.event.special[g.name].tb){var f=d.event.special[g.name]._default;d.event.special[g.name]._default=function(h){if(f&&f.apply&&(!h.namespace||h.namespace.indexOf("dataviz")===-1)){return f.apply(this,arguments)}return h.namespace&&h.namespace.indexOf("dataviz")>-1};d.event.special[g.name].tb=true}};d.fn.table_builder=function(g){var f=Array.prototype.slice.call(arguments,1);return this.each(function(){var j=d(this),h=j.data("dataviz.table_builder");if(!h){h=new b(this,typeof g=="object"&&g);j.data("dataviz.table_builder",h)}if(typeof g=="string"){if(d.inArray(g,["next","prev","paginate","search","clear_search","table_title","table_copyblock","credit_text","source_text","add_table_rows","add_row_data","clear_table_rows","refresh_data","sort","visible_rows","build_search","build_row_options","build_row_options_dropdown","create_header_buttons_small_select","header_click","build_small_sorter","check_data_type","update","destroy"])!=-1){try{h[g].apply(h,f)}catch(i){h.trigger("error",{action:{name:"update",error:{message:i}}})}}}})};d.fn.table_builder.Constructor=b})(window.jQuery,window,document);